--[[
	DOCUMENTATION:
	* MOST FUNCTIONS SHOULD RETURN A INSANITYCORE GUI INSTANCE!
	* A LIMIT OF ONE GUI INSTANCE OF INSANITYCORE AT A TIME!

	STYLES:
		Dark
		Light
		
	:NewStyle(StyleData: {})

	:Create(Style: {}): GUI
	:Destroy()
	
	:GetTitle(): TextLabel (guititle)
	:SetTitle(string)

]]



-- / Services \ --
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
-- \          / --

-- / Variables \ --
local Client = Players.LocalPlayer

local InsanityCore = {}
local Methods = {}
InsanityCore.Instance = nil
InsanityCore.InstanceStyle = nil
InsanityCore.CurrentTabs = {}
InsanityCore.Styles = {
	--[[
	Example = {
		ex.. ["type"] = {
			["name_here"] = {
			}
			["_default"] = {} -- only include when you have a general style for the classtype
		}
	}
	]]
	Dark = {
		["ScreenGui"] = {
			["_default"] = {
				["IgnoreGuiInset"] = true
			}
		},
		["Frame"] = {
			["IcMain"] = {
				["BackgroundColor3"] = Color3.fromRGB(32,32,32)
			},
			--["_default"] = {}
		},
		["UIStroke"] = {
			["IcMainBorderStroke"] = {
				["Color"] = Color3.fromRGB(0,0,0)
			},
			["IcTitleTextStroke"] = {
				["Transparency"] = 0.3
			},
			["TabButtonBorderStroke"] = {
				["Thickness"] = 1.5,
				["Color"] = Color3.fromRGB(20, 20, 20)
			},
			--["_default"] = {}
		},
		["TextLabel"] = {
			["IcTitle"] = {
				["TextColor3"] = Color3.fromRGB(255, 255, 255),
				["FontFace"] = Font.new("rbxasset://fonts/families/FredokaOne.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
			},
			["TabName"] = {
				["TextColor3"] = Color3.fromRGB(255, 255, 255),
				["FontFace"] = Font.new("rbxasset://fonts/families/FredokaOne.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
			},
		},
		["UIListLayout"] = {
			["TabButtonsULL"] = {
				["Padding"] = UDim.new(0.015, 0),
			},
		},
		--["UICorner"] = {
			
		--},
	},
	White = {},
}
InsanityCore.Settings = {
	DefaultStyle = InsanityCore.Styles.Dark,
	Create = {
		Loading = {
			Loads = false,
			LoadTime = 10,
			LoadIcon = ""
		}
	},
}
-- \           / --

-- / Functionality \ --

-- * SELF FUNCTIONS * --

function ApplyStyleTo(Element, Style)
	local Elements = Element:GetDescendants()
	table.insert(Elements, Element)
	for _, Object in Elements do
		local StyleData = Style[Object.ClassName]
		if StyleData then
			local SpecificData = StyleData[Object.Name] or StyleData["_default"] or {}
			for Property, Value in SpecificData do
				if Object[Property] then
					warn(Property)
					Object[Property] = Value
				end
			end
		end
	end
end

function Prompt(PromptData: {})
	-- to be made with gui later :)
	if PromptData["type"] == "Message" then
		warn(PromptData["Title"], ":", PromptData["Description"], ": Icon Provided:", PromptData["Icon"])
	else
		warn(`Internal error whilst prompting. Type provided: {PromptData["type"] or "nil"}`)
	end
end

-- * GLOBAL FUNCTIONS * --

function InsanityCore:Create(Style: string | nil | {}, Settings: {})
	-- Checks that will make the Style, and actual style
	if Style == nil then
		Style = InsanityCore.Settings.DefaultStyle
	elseif typeof(Style) == "string" then
		for Name, StyleData in InsanityCore.Styles do
			if Name == Style then Style = StyleData end
		end
	end
	
	-- Just incase that the first set of checks didn't work because of invalid arguments.
	if Style == nil or typeof(Style) == "string" or typeof(Style) ~= "table" then
		Prompt({
			["type"] = "Message",
			["Title"] = "Failed to create an instance of InsanityCore!",
			["Description"] = "Invalid parameters were provided into the creation function.",
			["Icon"] = "Error",
		})
		return
	end
	
	InsanityCore.InstanceStyle = Style
	
	-- Checking if there is another instance of InstanityCore
	if InsanityCore.Instance ~= nil then
		InsanityCore.Instance:Destroy()
		InsanityCore.InstanceStyle = nil
	end
	
	-- Creation Process
	local function New(ClassType: string, Name: string, Parent: Instance): Instance
		local NewInstance = Instance.new(ClassType, Parent)
		NewInstance.Name = Name
		return NewInstance
	end
	
	local Gui = New("ScreenGui", "InsanityCoreUiObject", CoreGui)
	InsanityCore.Instance = Gui
	
	local IcMain = New("Frame", "IcMain", Gui)
	IcMain.Position = UDim2.fromScale(0.5, 0.5)
	IcMain.AnchorPoint = Vector2.new(0.5, 0.5)
	IcMain.Size = UDim2.new(0.325, 0, 0.5, 0)
	
	local IcMainBorderStroke = New("UIStroke", "IcMainBorderStroke", IcMain)
	IcMainBorderStroke.Thickness = 2
	IcMainBorderStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	
	local IcMainUICorner = New("UICorner", "IcMainUICorner", IcMain)
	IcMainUICorner.CornerRadius = UDim.new(0.03, 0)
	
	local IcTitle = New("TextLabel", "IcTitle", IcMain)
	IcTitle.Size = UDim2.fromScale(1, 0.1)
	IcTitle.Position = UDim2.fromScale(0.015, -0.1)
	IcTitle.BackgroundTransparency = 1
	IcTitle.TextSize = 30
	IcTitle.TextXAlignment = Enum.TextXAlignment.Left
	IcTitle.TextYAlignment = Enum.TextYAlignment.Bottom
	IcTitle.TextWrapped = false
	
	local IcTitleTextStroke = New("UIStroke", "IcTitleTextStroke", IcTitle)
	IcTitleTextStroke.Thickness = 1.5
	
	local TabButtonsHolder = New("ScrollingFrame", "TabButtonsHolder", IcMain)
	TabButtonsHolder.BackgroundTransparency = 1
	TabButtonsHolder.AnchorPoint = Vector2.new(0.5,0)
	TabButtonsHolder.Position = UDim2.fromScale(0.5, 0.02)
	TabButtonsHolder.Size = UDim2.fromScale(0.98, 0.07)
	TabButtonsHolder.ScrollBarImageTransparency = 1
	TabButtonsHolder.ScrollingDirection = Enum.ScrollingDirection.X
	TabButtonsHolder.HorizontalScrollBarInset = Enum.ScrollBarInset.None
	TabButtonsHolder.AutomaticCanvasSize = Enum.AutomaticSize.X
	TabButtonsHolder.CanvasSize = UDim2.fromScale(0, 0)
	TabButtonsHolder.ClipsDescendants = false
	
	local TabButtonsUIListLayout = New("UIListLayout", "TabButtonsULL", TabButtonsHolder)
	TabButtonsUIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	TabButtonsUIListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	TabButtonsUIListLayout.FillDirection = Enum.FillDirection.Horizontal
	
	local TabFramesFolder = New("Folder", "TabFrames", IcMain)
	
	ApplyStyleTo(Gui, Style)
	
	return Methods
end

function Methods:CreateTab(TabData: {})
	--local Gui = InsanityCore.Instance
	--return Methods
	
	if not TabData["Identifier"] or not TabData["Text"] then 
		return 
	end
	
	local Gui = InsanityCore.Instance
	local IcMain = Gui:WaitForChild("IcMain")
	local TabFramesFolder = IcMain:WaitForChild("TabFrames")
	local TabButtonsHolder = IcMain:WaitForChild("TabButtonsHolder")
	
	-- Creation Process
	local function New(ClassType: string, Name: string, Parent: Instance): Instance
		local NewInstance = Instance.new(ClassType, Parent)
		NewInstance.Name = Name
		return NewInstance
	end
	
	local TabButton = New("TextButton", "TabButton", TabButtonsHolder)
	TabButton:SetAttribute("Identifier", TabData["Identifier"])
	TabButton.Size = UDim2.fromScale(0.15, 1)
	TabButton.Text = ""
	
	local TabName = New("TextLabel", "TabName", TabButton)
	TabName.Text = TabData["Text"]
	TabName.TextScaled = true
	TabName.Size = UDim2.fromScale(0.9, 0.9)
	TabName.AnchorPoint = Vector2.new(0.5, 0.5)
	TabName.Position = UDim2.fromScale(0.5, 0.5)
	
	local TabNameTextStroke = New("UIStroke", "TabNameTextStroke", TabName)
	
	local TabButtonBorderStroke = New("UIStroke", "TabButtonBorderStroke", TabButton)
	TabButtonBorderStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	
	local TabButtonUICorner = New("UICorner", "TabButtonUICorner", TabButton)
	TabButtonUICorner.CornerRadius = UDim.new(1, 0)
	
	-- Tab Frame
	
	local TabFrame = New("Frame", "TabFrame", TabFramesFolder)
	TabFrame.Size = UDim2.fromScale(1, 0.9)
	TabFrame.Position = UDim2.fromScale(0.5, 0.1)
	TabFrame.AnchorPoint = Vector2.new(0.5, 0)
	
	InsanityCore.CurrentTabs[TabData["Identifier"]] = {["TabButton"] = TabButton, ["TabFrame"] = TabFrame}	
	
	ApplyStyleTo(Gui, InsanityCore.InstanceStyle)
	
	--local TabFrame = New("Frame")
	local TabMethods = {}
	-- LATER (add more obviously)
	function TabMethods:CreateButton(ButtonData: {})
		
	end
	function TabMethods:CreateDivider(DividerData: {})
		
	end
	function TabMethods:CreateText(TextData: {})
		
	end
	function TabMethods:ToggleFrame(Bool)
		TabFrame.Visible = Bool or not TabFrame.Visible
		return TabMethods
	end
	return TabMethods
end

function Methods:ChangeIndentifier(Identifier: string, NewIdentifier: string)
	
end

function Methods:DestroyTab(Identifier: string)
	
end

function Methods:GetTab(Identifier: string)
	
end

function Methods:SetTitle(Title: string)
	local Gui = InsanityCore.Instance
	local IcMain = Gui.IcMain
	local IcTitle = IcMain.IcTitle
	IcTitle.Text = Title
	return Methods
end

function Methods:Toggle(Bool)
	local Gui = InsanityCore.Instance
	--local IcMain = Gui.IcMain
	warn(Bool)
	Gui.Enabled = Bool or not Gui.Enabled
	return Methods
end

--function Methods:Wait()
	
--end

-- Primarily used during testing --
function InsanityCore:ClearAllInstances()
	for Index, Gui in CoreGui:GetChildren() do
		if string.find(Gui.Name, "InsanityCoreUiObject") then
			Gui:Destroy()
		end
	end
end

function Methods:Destroy()
	if InsanityCore.Instance ~= nil then
		InsanityCore.Instance:Destroy()
		InsanityCore.Instance = nil
	end
end

return InsanityCore
-- \               / --
